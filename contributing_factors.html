<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2020-11-21" />

<title>Contributing Factors</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="site_libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="mailto:&lt;you@youremail.com&gt;">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/byilma/nyc_microvehicle_injuries">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Contributing Factors</h1>
<h4 class="date">11/21/2020</h4>

</div>


<p>The goal of these analyses is to understand whether there have been changes in contributing factors of bike and microvehicle crashes during the COVID-19 pandemic as compared to prior to the pandemic. We hypothesized that there would be changes in contributing factors due to changes in traffic patterns as a result of the pandemic. For example, as many businesses have transitioned to remote work, city streets may become less congested with cars, which could result in increased speeding or other unsafe driving behaviors. In addition, as many healthcare workers were offered free CITI bike memberships during the pandemic, there may have been an increase in the number of new bike riders, who may have less riding experience and be more prone to bike riding errors.</p>
<p>The NYC Department of Transportation Motor Vehicle Collisions - Crashes data contain a contributing factor variable that is designated for each vehicle involved in the collision. These contributing factors are recorded on the police accident report by the crash investigator, who is responsible for determining the apparent reason for the collision. Contributing factors include options like aggressive driving, failure to yield right-of-way, unsafe speed, and bicyclist error/confusion.</p>
<p>In this first analysis, we compared the top ten contributing factors in bike crashes pre- and during COVID-19. We subset the collision data to crashes involving a bike where a cyclist was injured. Since we are making comparisons pre- and during the pandemic, We further restricted the data to crashes occurring in March through October to control for potential seasonal effects. Crashes that occurred pre-2020 were classified as pre-COVID and crashes that occurred in 2020 were classified as during COVID. Contributing factors were summarized as the proportion of collisions that involved the given factor. Since multiple contributing factors can be recorded for each collision, these proportions will not sum to 100%.</p>
<pre class="r"><code>bikes = 
  read_csv(&quot;./data/crash_dat.csv&quot;) %&gt;%
  filter(str_starts(vehicle_options, &quot;[Bb]ike&quot;)) %&gt;%
  filter(
    month %in% (3:10),
    number_of_cyclist_injured &gt; 0
    ) %&gt;%
  separate(crash_time, into = c(&quot;hour&quot;, &quot;minute&quot;, &quot;second&quot;), sep = &quot;:&quot;) %&gt;%
  mutate(
    covid = as.factor(if_else(year &lt; 2020, &#39;Pre-COVID&#39;, &#39;COVID&#39;)),
    vehicle_number = str_extract_all(vehicle_number, &quot;\\d&quot;, simplify = TRUE)
  ) </code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   date = col_date(format = &quot;&quot;),
##   crash_time = col_time(format = &quot;&quot;),
##   borough = col_character(),
##   location = col_character(),
##   on_street_name = col_character(),
##   off_street_name = col_character(),
##   cross_street_name = col_character(),
##   contributing_factor_vehicle_1 = col_character(),
##   contributing_factor_vehicle_2 = col_character(),
##   contributing_factor_vehicle_3 = col_character(),
##   contributing_factor_vehicle_4 = col_character(),
##   contributing_factor_vehicle_5 = col_character(),
##   dow = col_character(),
##   vehicle_number = col_character(),
##   vehicle_options = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<pre class="r"><code>bike_factor = 
  bikes %&gt;%
  pivot_longer(
    contributing_factor_vehicle_1:contributing_factor_vehicle_5,
    names_to = &quot;vehicle_factor_num&quot;,
    names_prefix = &quot;contributing_factor_vehicle_&quot;,
    values_to = &quot;contributing_factor&quot;
   ) %&gt;%
  mutate(
    contributing_factor = if_else(contributing_factor == &quot;Pedestrian/Bicyclist/Other Pedestrian Error/Confusion&quot;, &quot;Pedestrian/Cyclist Error&quot;, contributing_factor)
  ) %&gt;%
  group_by(covid, contributing_factor) %&gt;%
  summarise(
    collisions = n_distinct(collision_id)
  ) %&gt;%
  drop_na(contributing_factor) %&gt;%
  ungroup(contributing_factor) %&gt;%
  filter(contributing_factor != &quot;Unspecified&quot;) %&gt;%
  mutate(
    covid = fct_relevel(covid, &#39;Pre-COVID&#39;),
    proportion = round(collisions / sum(collisions), 2) 
  ) </code></pre>
<pre><code>## `summarise()` regrouping output by &#39;covid&#39; (override with `.groups` argument)</code></pre>
<pre class="r"><code>top_10_bike = 
  bike_factor %&gt;%
  group_by(covid) %&gt;%
  top_n(n = 10, wt = proportion) %&gt;%
  mutate(
    contributing_factor = fct_reorder(as.factor(contributing_factor), collisions, .desc = TRUE)
  ) %&gt;%
  ggplot(aes(x = contributing_factor, y = proportion, fill = covid)) +
  geom_bar(stat = &quot;identity&quot;) +
  facet_grid( . ~covid, scales = &quot;free_x&quot;, space = &quot;free_x&quot;) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1), legend.position = &quot;none&quot;) +
  labs(
    title = &quot;Top Ten Contributing Factors for Crashes Involving Injuries to Cyclists&quot;,
    x = &quot;&quot;,
    y = &quot;Proportion of Crashes&quot;
  )

ggplotly(top_10_bike) </code></pre>
<div id="htmlwidget-f9c8ce66516c3d4e7587" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-f9c8ce66516c3d4e7587">{"x":{"data":[{"orientation":"v","width":[0.9,0.899999999999999,0.9,0.9,0.899999999999999,0.899999999999999,0.9,0.9,0.9,0.9,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[1,9,3,6,8,13,5,7,2,4,10,14,11,12],"y":[0.33,0.02,0.14,0.03,0.02,0.02,0.06,0.03,0.15,0.06,0.02,0.02,0.02,0.02],"text":["contributing_factor: Driver Inattention/Distraction<br />proportion: 0.33<br />covid: Pre-COVID","contributing_factor: Driver Inexperience<br />proportion: 0.02<br />covid: Pre-COVID","contributing_factor: Failure to Yield Right-of-Way<br />proportion: 0.14<br />covid: Pre-COVID","contributing_factor: Following Too Closely<br />proportion: 0.03<br />covid: Pre-COVID","contributing_factor: Other Vehicular<br />proportion: 0.02<br />covid: Pre-COVID","contributing_factor: Passenger Distraction<br />proportion: 0.02<br />covid: Pre-COVID","contributing_factor: Passing or Lane Usage Improper<br />proportion: 0.06<br />covid: Pre-COVID","contributing_factor: Passing Too Closely<br />proportion: 0.03<br />covid: Pre-COVID","contributing_factor: Pedestrian/Cyclist Error<br />proportion: 0.15<br />covid: Pre-COVID","contributing_factor: Traffic Control Disregarded<br />proportion: 0.06<br />covid: Pre-COVID","contributing_factor: Turning Improperly<br />proportion: 0.02<br />covid: Pre-COVID","contributing_factor: Unsafe Lane Changing<br />proportion: 0.02<br />covid: Pre-COVID","contributing_factor: Unsafe Speed<br />proportion: 0.02<br />covid: Pre-COVID","contributing_factor: View Obstructed/Limited<br />proportion: 0.02<br />covid: Pre-COVID"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(68,1,84,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"Pre-COVID","legendgroup":"Pre-COVID","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.9,0.899999999999999,0.9,0.9,0.899999999999999,0.9,0.9,0.9,0.9,0.899999999999999,0.899999999999999,0.899999999999999],"base":[0,0,0,0,0,0,0,0,0,0,0,0],"x":[1,9,3,6,8,5,7,2,4,10,11,12],"y":[0.37,0.02,0.15,0.03,0.03,0.06,0.02,0.12,0.07,0.02,0.02,0.02],"text":["contributing_factor: Driver Inattention/Distraction<br />proportion: 0.37<br />covid: COVID","contributing_factor: Driver Inexperience<br />proportion: 0.02<br />covid: COVID","contributing_factor: Failure to Yield Right-of-Way<br />proportion: 0.15<br />covid: COVID","contributing_factor: Following Too Closely<br />proportion: 0.03<br />covid: COVID","contributing_factor: Other Vehicular<br />proportion: 0.03<br />covid: COVID","contributing_factor: Passing or Lane Usage Improper<br />proportion: 0.06<br />covid: COVID","contributing_factor: Passing Too Closely<br />proportion: 0.02<br />covid: COVID","contributing_factor: Pedestrian/Cyclist Error<br />proportion: 0.12<br />covid: COVID","contributing_factor: Traffic Control Disregarded<br />proportion: 0.07<br />covid: COVID","contributing_factor: Turning Improperly<br />proportion: 0.02<br />covid: COVID","contributing_factor: Unsafe Speed<br />proportion: 0.02<br />covid: COVID","contributing_factor: View Obstructed/Limited<br />proportion: 0.02<br />covid: COVID"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(253,231,37,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"COVID","legendgroup":"COVID","showlegend":true,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":55.4520547945205,"r":18.9954337899543,"b":106.19699611439,"l":43.1050228310502},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Top Ten Contributing Factors for Crashes Involving Injuries to Cyclists","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,0.495923026744945],"automargin":true,"type":"linear","autorange":false,"range":[0.4,14.6],"tickmode":"array","ticktext":["Driver Inattention/Distraction","Pedestrian/Cyclist Error","Failure to Yield Right-of-Way","Traffic Control Disregarded","Passing or Lane Usage Improper","Following Too Closely","Passing Too Closely","Other Vehicular","Driver Inexperience","Turning Improperly","Unsafe Speed","View Obstructed/Limited","Passenger Distraction","Unsafe Lane Changing"],"tickvals":[1,2,3,4,5,6,7,8,9,10,11,12,13,14],"categoryorder":"array","categoryarray":["Driver Inattention/Distraction","Pedestrian/Cyclist Error","Failure to Yield Right-of-Way","Traffic Control Disregarded","Passing or Lane Usage Improper","Following Too Closely","Passing Too Closely","Other Vehicular","Driver Inexperience","Turning Improperly","Unsafe Speed","View Obstructed/Limited","Passenger Distraction","Unsafe Lane Changing"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-45,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.0185,0.3885],"tickmode":"array","ticktext":["0.0","0.1","0.2","0.3"],"tickvals":[0,0.1,0.2,0.3],"categoryorder":"array","categoryarray":["0.0","0.1","0.2","0.3"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"annotations":[{"text":"Proportion of Crashes","x":-0.0159001956947162,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis"},{"text":"Pre-COVID","x":0.247961513372472,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"COVID","x":0.752038486627528,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.495923026744945,"y0":0,"y1":1},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.495923026744945,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.504076973255055,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.504076973255055,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[0.4,12.6],"tickmode":"array","ticktext":["Driver Inattention/Distraction","Pedestrian/Cyclist Error","Failure to Yield Right-of-Way","Traffic Control Disregarded","Passing or Lane Usage Improper","Following Too Closely","Passing Too Closely","Other Vehicular","Driver Inexperience","Turning Improperly","Unsafe Speed","View Obstructed/Limited"],"tickvals":[1,2,3,4,5,6,7,8,9,10,11,12],"categoryorder":"array","categoryarray":["Driver Inattention/Distraction","Pedestrian/Cyclist Error","Failure to Yield Right-of-Way","Traffic Control Disregarded","Passing or Lane Usage Improper","Following Too Closely","Passing Too Closely","Other Vehicular","Driver Inexperience","Turning Improperly","Unsafe Speed","View Obstructed/Limited"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-45,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.504076973255055,1],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"showlegend":false,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"82884c984670":{"x":{},"y":{},"fill":{},"type":"bar"}},"cur_data":"82884c984670","visdat":{"82884c984670":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>As seen in this plot, the leading contributing factor for bike crashes involving cyclist injuries was driver inattention or distraction both pre- and during the pandemic. However, the proportion of crashes with driver inattention listed as a contributing factor increased from 33% pre-pandemic to 37% during the pandemic. Similarly, there was a slight decrease in the proportion of bike crashes involving cyclist error during the pandemic, with 15% of crashes having this listed as a contributing factor pre-pandemic as compared to 12% during the pandemic.</p>
<p>The following analysis replicates the analysis above for microvehicle crashes involving an injury.</p>
<pre class="r"><code>microveh = 
  read_csv(&quot;./data/crash_dat.csv&quot;) %&gt;%
  filter(str_detect(vehicle_options, &quot;[Bb]ike&quot;) | 
           str_detect(vehicle_options, &quot;REVEL&quot;) | 
           str_detect(vehicle_options, &quot;SCO&quot;)  |
           str_detect(vehicle_options, &quot;MOP&quot;)   |
           str_detect(vehicle_options, &quot;ELEC&quot;)  |
           str_detect(vehicle_options, &quot;^E-&quot;)) %&gt;% 
  filter(vehicle_options != &quot;ESCOVATOR&quot; &amp; vehicle_options != &quot;Bike&quot; &amp;
      str_detect(vehicle_options, &quot;Dirt&quot;, negate = TRUE),
      str_detect(vehicle_options, &quot;[Mm]otorbike&quot;, negate = TRUE)
           ) %&gt;%
  filter(
    month %in% (3:10),
    number_of_persons_injured &gt; 0
    ) %&gt;%
  separate(crash_time, into = c(&quot;hour&quot;, &quot;minute&quot;, &quot;second&quot;), sep = &quot;:&quot;) %&gt;%
  mutate(
    covid = as.factor(if_else(year &lt; 2020, &#39;Pre-COVID&#39;, &#39;COVID&#39;)),
    vehicle_number = str_extract_all(vehicle_number, &quot;\\d&quot;, simplify = TRUE)
  ) </code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   date = col_date(format = &quot;&quot;),
##   crash_time = col_time(format = &quot;&quot;),
##   borough = col_character(),
##   location = col_character(),
##   on_street_name = col_character(),
##   off_street_name = col_character(),
##   cross_street_name = col_character(),
##   contributing_factor_vehicle_1 = col_character(),
##   contributing_factor_vehicle_2 = col_character(),
##   contributing_factor_vehicle_3 = col_character(),
##   contributing_factor_vehicle_4 = col_character(),
##   contributing_factor_vehicle_5 = col_character(),
##   dow = col_character(),
##   vehicle_number = col_character(),
##   vehicle_options = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<pre class="r"><code>micro_factor = 
  microveh %&gt;%
  pivot_longer(
    contributing_factor_vehicle_1:contributing_factor_vehicle_5,
    names_to = &quot;vehicle_factor_num&quot;,
    names_prefix = &quot;contributing_factor_vehicle_&quot;,
    values_to = &quot;contributing_factor&quot;
   ) %&gt;%
  mutate(
    contributing_factor = if_else(contributing_factor == &quot;Pedestrian/Bicyclist/Other Pedestrian Error/Confusion&quot;, &quot;Pedestrian/Cyclist Error&quot;, contributing_factor)
  ) %&gt;%
  group_by(covid, contributing_factor) %&gt;%
  summarise(
    collisions = n_distinct(collision_id)
  ) %&gt;%
  drop_na(contributing_factor) %&gt;%
  ungroup(contributing_factor) %&gt;%
  filter(contributing_factor != &quot;Unspecified&quot;) %&gt;%
  mutate(
    covid = fct_relevel(covid, &#39;Pre-COVID&#39;),
    proportion = round(collisions / sum(collisions), 2) 
  ) </code></pre>
<pre><code>## `summarise()` regrouping output by &#39;covid&#39; (override with `.groups` argument)</code></pre>
<pre class="r"><code>top_10_micro = 
  micro_factor %&gt;%
  group_by(covid) %&gt;%
  top_n(n = 10, wt = proportion) %&gt;%
  mutate(
    contributing_factor = fct_reorder(as.factor(contributing_factor), collisions, .desc = TRUE)
  ) %&gt;%
  ggplot(aes(x = contributing_factor, y = proportion, fill = covid)) +
  geom_bar(stat = &quot;identity&quot;) +
  facet_grid( . ~covid, scales = &quot;free_x&quot;, space = &quot;free_x&quot;) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1), legend.position = &quot;none&quot;) +
  labs(
    title = &quot;Top Ten Contributing Factors for Microvehicle Crashes Involving Injuries&quot;,
    x = &quot;&quot;,
    y = &quot;Proportion of Crashes&quot;
  )

ggplotly(top_10_micro) </code></pre>
<div id="htmlwidget-b49b0a3f5236da603dcd" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-b49b0a3f5236da603dcd">{"x":{"data":[{"orientation":"v","width":[0.9,0.9,0.9,0.899999999999999,0.9,0.9,0.899999999999999,0.899999999999999,0.9,0.899999999999999,0.899999999999999,0.9,0.899999999999999],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[1,5,2,9,7,4,13,8,3,11,10,6,12],"y":[0.37,0.06,0.11,0.02,0.04,0.08,0.02,0.04,0.09,0.02,0.02,0.04,0.02],"text":["contributing_factor: Driver Inattention/Distraction<br />proportion: 0.37<br />covid: Pre-COVID","contributing_factor: Driver Inexperience<br />proportion: 0.06<br />covid: Pre-COVID","contributing_factor: Failure to Yield Right-of-Way<br />proportion: 0.11<br />covid: Pre-COVID","contributing_factor: Following Too Closely<br />proportion: 0.02<br />covid: Pre-COVID","contributing_factor: Other Vehicular<br />proportion: 0.04<br />covid: Pre-COVID","contributing_factor: Passing or Lane Usage Improper<br />proportion: 0.08<br />covid: Pre-COVID","contributing_factor: Passing Too Closely<br />proportion: 0.02<br />covid: Pre-COVID","contributing_factor: Pedestrian/Cyclist Error<br />proportion: 0.04<br />covid: Pre-COVID","contributing_factor: Traffic Control Disregarded<br />proportion: 0.09<br />covid: Pre-COVID","contributing_factor: Turning Improperly<br />proportion: 0.02<br />covid: Pre-COVID","contributing_factor: Unsafe Lane Changing<br />proportion: 0.02<br />covid: Pre-COVID","contributing_factor: Unsafe Speed<br />proportion: 0.04<br />covid: Pre-COVID","contributing_factor: View Obstructed/Limited<br />proportion: 0.02<br />covid: Pre-COVID"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(68,1,84,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"Pre-COVID","legendgroup":"Pre-COVID","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.9,0.9,0.9,0.899999999999999,0.9,0.9,0.899999999999999,0.9,0.899999999999999,0.9],"base":[0,0,0,0,0,0,0,0,0,0],"x":[1,5,2,9,7,4,8,3,10,6],"y":[0.37,0.04,0.13,0.04,0.04,0.07,0.04,0.08,0.03,0.05],"text":["contributing_factor: Driver Inattention/Distraction<br />proportion: 0.37<br />covid: COVID","contributing_factor: Driver Inexperience<br />proportion: 0.04<br />covid: COVID","contributing_factor: Failure to Yield Right-of-Way<br />proportion: 0.13<br />covid: COVID","contributing_factor: Following Too Closely<br />proportion: 0.04<br />covid: COVID","contributing_factor: Other Vehicular<br />proportion: 0.04<br />covid: COVID","contributing_factor: Passing or Lane Usage Improper<br />proportion: 0.07<br />covid: COVID","contributing_factor: Pedestrian/Cyclist Error<br />proportion: 0.04<br />covid: COVID","contributing_factor: Traffic Control Disregarded<br />proportion: 0.08<br />covid: COVID","contributing_factor: Turning Improperly<br />proportion: 0.03<br />covid: COVID","contributing_factor: Unsafe Speed<br />proportion: 0.05<br />covid: COVID"],"type":"bar","marker":{"autocolorscale":false,"color":"rgba(253,231,37,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"COVID","legendgroup":"COVID","showlegend":true,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":55.4520547945205,"r":18.9954337899543,"b":106.19699611439,"l":43.1050228310502},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Top Ten Contributing Factors for Microvehicle Crashes Involving Injuries","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,0.495923026744945],"automargin":true,"type":"linear","autorange":false,"range":[0.4,13.6],"tickmode":"array","ticktext":["Driver Inattention/Distraction","Failure to Yield Right-of-Way","Traffic Control Disregarded","Passing or Lane Usage Improper","Driver Inexperience","Unsafe Speed","Other Vehicular","Pedestrian/Cyclist Error","Following Too Closely","Unsafe Lane Changing","Turning Improperly","View Obstructed/Limited","Passing Too Closely"],"tickvals":[1,2,3,4,5,6,7,8,9,10,11,12,13],"categoryorder":"array","categoryarray":["Driver Inattention/Distraction","Failure to Yield Right-of-Way","Traffic Control Disregarded","Passing or Lane Usage Improper","Driver Inexperience","Unsafe Speed","Other Vehicular","Pedestrian/Cyclist Error","Following Too Closely","Unsafe Lane Changing","Turning Improperly","View Obstructed/Limited","Passing Too Closely"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-45,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.0185,0.3885],"tickmode":"array","ticktext":["0.0","0.1","0.2","0.3"],"tickvals":[0,0.1,0.2,0.3],"categoryorder":"array","categoryarray":["0.0","0.1","0.2","0.3"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"annotations":[{"text":"Proportion of Crashes","x":-0.0159001956947162,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis"},{"text":"Pre-COVID","x":0.247961513372472,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"COVID","x":0.752038486627528,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.495923026744945,"y0":0,"y1":1},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.495923026744945,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.504076973255055,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.504076973255055,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[0.4,10.6],"tickmode":"array","ticktext":["Driver Inattention/Distraction","Failure to Yield Right-of-Way","Traffic Control Disregarded","Passing or Lane Usage Improper","Driver Inexperience","Unsafe Speed","Other Vehicular","Pedestrian/Cyclist Error","Following Too Closely","Turning Improperly"],"tickvals":[1,2,3,4,5,6,7,8,9,10],"categoryorder":"array","categoryarray":["Driver Inattention/Distraction","Failure to Yield Right-of-Way","Traffic Control Disregarded","Passing or Lane Usage Improper","Driver Inexperience","Unsafe Speed","Other Vehicular","Pedestrian/Cyclist Error","Following Too Closely","Turning Improperly"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-45,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.504076973255055,1],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"showlegend":false,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"828819ef3b0c":{"x":{},"y":{},"fill":{},"type":"bar"}},"cur_data":"828819ef3b0c","visdat":{"828819ef3b0c":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>As seen in the bike analysis, the leading contributing factor for microvehicle crashes involving injuries was driver inattention or distraction both pre- and during the pandemic, with 37% of crashes involving this factor at both time periods. Differences in contributing factors in these microvehicle crashes were minor.</p>
<p>In addition to the contributing factors listed on the crash report, collisions are often observed to cluster by time of day and day of week. For example, crashes tend to cluster during weekdays at rush hour, when more cars are on the road. Since many individuals are no longer commuting to work, it’s possible that this clustering will have changed during the pandemic. We therefore explored whether this clustering by time of day and day of week changed pre-pandemic versus during the pandemic.</p>
<p>To accomplish this, we created a heat map of bike crashes involving a cyclist injury by time of day and day of week pre and during COVID.</p>
<pre class="r"><code>crash_day_time = 
  bikes %&gt;%
  group_by(covid, hour, dow) %&gt;%
  summarise(
    collisions = n_distinct(collision_id)
  ) %&gt;%
  mutate(
    covid = fct_relevel(covid, &#39;Pre-COVID&#39;),
    dow = fct_relevel(dow, &quot;Sunday&quot;, &quot;Saturday&quot;, &quot;Friday&quot;, &quot;Thursday&quot;, &quot;Wednesday&quot;, &quot;Tuesday&quot;)
  ) </code></pre>
<pre><code>## `summarise()` regrouping output by &#39;covid&#39;, &#39;hour&#39; (override with `.groups` argument)</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `dow`.
## i Unknown levels in `f`: Tuesday
## i Input `dow` is `fct_relevel(...)`.
## i The error occurred in group 5: covid = &quot;COVID&quot;, hour = &quot;04&quot;.</code></pre>
<pre><code>## Warning: Unknown levels in `f`: Tuesday</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `dow`.
## i Unknown levels in `f`: Wednesday
## i Input `dow` is `fct_relevel(...)`.
## i The error occurred in group 6: covid = &quot;COVID&quot;, hour = &quot;05&quot;.</code></pre>
<pre><code>## Warning: Unknown levels in `f`: Wednesday</code></pre>
<pre class="r"><code>a &lt;- list(
  text = &quot;Pre-COVID&quot;,
  xref = &quot;paper&quot;,
  yref = &quot;paper&quot;,
  yanchor = &quot;bottom&quot;,
  xanchor = &quot;center&quot;,
  align = &quot;center&quot;,
  x = 0.5,
  y = 1,
  showarrow = FALSE
)

b &lt;- list(
  text = &quot;COVID&quot;,
  xref = &quot;paper&quot;,
  yref = &quot;paper&quot;,
  yanchor = &quot;bottom&quot;,
  xanchor = &quot;center&quot;,
  align = &quot;center&quot;,
  x = 0.5,
  y = 1,
  showarrow = FALSE
)


pre_heat = 
  crash_day_time %&gt;%
  filter(covid == &quot;Pre-COVID&quot;) %&gt;%
  plot_ly(
    x = ~hour, y = ~dow, z = ~collisions, type = &quot;heatmap&quot;, colors = &quot;BuPu&quot;
  ) %&gt;%
  hide_colorbar() %&gt;%
  layout(annotations = a)

covid_heat = 
  crash_day_time %&gt;%
  filter(covid == &quot;COVID&quot;) %&gt;%
  plot_ly(
    x = ~hour, y = ~dow, z = ~collisions, type = &quot;heatmap&quot;, colors = &quot;BuPu&quot;
  ) %&gt;%
  hide_colorbar() %&gt;%
  layout(annotations = b)

subplot(pre_heat, covid_heat, nrows = 2, margin = .1)</code></pre>
<div id="htmlwidget-431649894a01b675192c" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-431649894a01b675192c">{"x":{"data":[{"colorbar":{"title":"collisions","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(247,252,253,1)"],["0.0416666666666667","rgba(239,247,250,1)"],["0.0833333333333333","rgba(232,241,247,1)"],["0.125","rgba(224,236,244,1)"],["0.166666666666667","rgba(213,228,239,1)"],["0.208333333333333","rgba(202,219,235,1)"],["0.25","rgba(191,211,230,1)"],["0.291666666666667","rgba(180,203,226,1)"],["0.333333333333333","rgba(169,196,222,1)"],["0.375","rgba(158,188,218,1)"],["0.416666666666667","rgba(152,175,211,1)"],["0.458333333333333","rgba(146,163,205,1)"],["0.5","rgba(140,150,198,1)"],["0.541666666666667","rgba(141,136,191,1)"],["0.583333333333333","rgba(141,122,184,1)"],["0.625","rgba(140,107,177,1)"],["0.666666666666667","rgba(139,94,170,1)"],["0.708333333333333","rgba(138,80,164,1)"],["0.75","rgba(136,65,157,1)"],["0.791666666666667","rgba(134,52,146,1)"],["0.833333333333333","rgba(132,36,135,1)"],["0.875","rgba(129,15,124,1)"],["0.916666666666667","rgba(111,8,107,1)"],["0.958333333333333","rgba(94,3,91,1)"],["1","rgba(77,0,75,1)"]],"showscale":false,"x":["00","00","00","00","00","00","00","01","01","01","01","01","01","01","02","02","02","02","02","02","02","03","03","03","03","03","03","03","04","04","04","04","04","04","04","05","05","05","05","05","05","05","06","06","06","06","06","06","06","07","07","07","07","07","07","07","08","08","08","08","08","08","08","09","09","09","09","09","09","09","10","10","10","10","10","10","10","11","11","11","11","11","11","11","12","12","12","12","12","12","12","13","13","13","13","13","13","13","14","14","14","14","14","14","14","15","15","15","15","15","15","15","16","16","16","16","16","16","16","17","17","17","17","17","17","17","18","18","18","18","18","18","18","19","19","19","19","19","19","19","20","20","20","20","20","20","20","21","21","21","21","21","21","21","22","22","22","22","22","22","22","23","23","23","23","23","23","23"],"y":["Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday"],"z":[55,50,71,54,60,40,40,26,14,27,28,10,10,12,16,7,21,16,16,7,13,7,4,16,13,5,3,5,8,10,24,12,8,4,8,8,15,9,10,12,10,8,26,21,7,9,28,22,30,45,29,18,14,34,55,54,64,65,28,23,74,88,81,77,68,50,34,78,94,61,63,51,61,45,75,79,59,88,55,79,56,68,58,63,74,78,105,75,76,65,72,98,73,94,102,68,84,98,112,87,117,125,86,92,103,110,102,103,106,119,104,111,129,122,112,116,102,127,105,140,131,101,102,144,167,134,138,127,107,108,124,133,138,132,105,99,110,120,134,108,120,87,89,99,106,103,100,81,88,95,91,85,93,89,85,61,80,62,73,66,60,56,42,55,31,52,48,47],"type":"heatmap","xaxis":"x","yaxis":"y","frame":null},{"colorbar":{"title":"collisions","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(247,252,253,1)"],["0.0416666666666667","rgba(239,247,250,1)"],["0.0833333333333333","rgba(232,241,247,1)"],["0.125","rgba(224,236,244,1)"],["0.166666666666667","rgba(213,228,239,1)"],["0.208333333333333","rgba(202,219,235,1)"],["0.25","rgba(191,211,230,1)"],["0.291666666666667","rgba(180,203,226,1)"],["0.333333333333333","rgba(169,196,222,1)"],["0.375","rgba(158,188,218,1)"],["0.416666666666667","rgba(152,175,211,1)"],["0.458333333333333","rgba(146,163,205,1)"],["0.5","rgba(140,150,198,1)"],["0.541666666666667","rgba(141,136,191,1)"],["0.583333333333333","rgba(141,122,184,1)"],["0.625","rgba(140,107,177,1)"],["0.666666666666667","rgba(139,94,170,1)"],["0.708333333333333","rgba(138,80,164,1)"],["0.75","rgba(136,65,157,1)"],["0.791666666666667","rgba(134,52,146,1)"],["0.833333333333333","rgba(132,36,135,1)"],["0.875","rgba(129,15,124,1)"],["0.916666666666667","rgba(111,8,107,1)"],["0.958333333333333","rgba(94,3,91,1)"],["1","rgba(77,0,75,1)"]],"showscale":false,"x":["00","00","00","00","00","00","00","01","01","01","01","01","01","01","02","02","02","02","02","02","02","03","03","03","03","03","03","03","04","04","04","04","04","05","05","05","05","05","05","06","06","06","06","06","06","06","07","07","07","07","07","07","07","08","08","08","08","08","08","08","09","09","09","09","09","09","09","10","10","10","10","10","10","10","11","11","11","11","11","11","11","12","12","12","12","12","12","12","13","13","13","13","13","13","13","14","14","14","14","14","14","14","15","15","15","15","15","15","15","16","16","16","16","16","16","16","17","17","17","17","17","17","17","18","18","18","18","18","18","18","19","19","19","19","19","19","19","20","20","20","20","20","20","20","21","21","21","21","21","21","21","22","22","22","22","22","22","22","23","23","23","23","23","23","23"],"y":["Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Saturday","Sunday","Thursday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday"],"z":[21,14,14,11,15,12,13,4,3,4,8,4,2,3,4,2,2,6,4,4,2,4,2,5,10,2,3,1,3,2,5,1,1,6,5,3,3,2,5,6,5,4,3,9,8,4,14,12,7,4,13,6,13,13,10,6,6,17,20,21,14,14,10,7,11,18,21,16,13,11,11,19,12,12,18,13,24,23,21,15,15,21,21,17,20,29,29,21,27,22,26,30,34,20,25,29,22,34,33,22,25,28,30,34,36,25,29,20,24,41,35,47,41,51,37,42,46,44,27,32,51,43,48,46,38,41,36,39,38,35,38,25,33,23,36,34,46,34,20,35,32,34,37,23,23,24,26,23,27,22,18,23,6,26,21,15,13,31,21,10,19,17,13,8,13],"type":"heatmap","xaxis":"x2","yaxis":"y2","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"type":"category","categoryorder":"array","categoryarray":["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],"anchor":"y"},"xaxis2":{"domain":[0,1],"automargin":true,"type":"category","categoryorder":"array","categoryarray":["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],"anchor":"y2"},"yaxis2":{"domain":[0,0.4],"automargin":true,"type":"category","categoryorder":"array","categoryarray":["Sunday","Saturday","Friday","Thursday","Wednesday","Tuesday","Monday"],"anchor":"x2"},"yaxis":{"domain":[0.6,1],"automargin":true,"type":"category","categoryorder":"array","categoryarray":["Sunday","Saturday","Friday","Thursday","Wednesday","Tuesday","Monday"],"anchor":"x"},"annotations":[{"text":"Pre-COVID","xref":"paper","yref":"paper","yanchor":"bottom","xanchor":"center","align":"center","x":0.5,"y":1,"showarrow":false},{"text":"COVID","xref":"paper","yref":"paper","yanchor":"bottom","xanchor":"center","align":"center","x":0.5,"y":0.4,"showarrow":false}],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"zaxis":{"title":"collisions"}},"hovermode":"closest","showlegend":true,"legend":{"yanchor":"top","y":0.5}},"attrs":{"828877895743":{"x":{},"y":{},"z":{},"colors":"BuPu","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"heatmap"},"828813fa4e8a":{"x":{},"y":{},"z":{},"colors":"BuPu","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"heatmap"}},"source":"A","config":{"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>As seen in this plot, there was a similar trend pre- and during COVID, where the majority of bike crashes are clustered in the evening hours. There did seem to be slightly more clustering in the evening rush hour times of 4-6 PM during COVID as compared to pre-COVID. In addition, even fewer bike crashes were clustered in the morning hours during COVID.</p>
<p>In next analysis, we further explored clustering by time of day and day of week based on whether the crash had a contributing factor attributed to the cyclist, which was defined as either having a factor of cyclist error or a valid factor with the same vehicle number as the bike vehicle number.</p>
<pre class="r"><code>day_time_bike_err = 
  bikes %&gt;%
  pivot_longer(
    contributing_factor_vehicle_1:contributing_factor_vehicle_5,
    names_to = &quot;vehicle_factor_num&quot;,
    names_prefix = &quot;contributing_factor_vehicle_&quot;,
    values_to = &quot;contributing_factor&quot;
   ) %&gt;%
  filter((contributing_factor == &quot;Pedestrian/Cyclist Error&quot; |
           vehicle_factor_num == vehicle_number),
         contributing_factor != &quot;Unspecified&quot;) %&gt;%
  group_by(covid, hour, dow) %&gt;%
  summarise(
    collisions = n_distinct(collision_id)
  ) %&gt;%
  mutate(
    covid = fct_relevel(covid, &#39;Pre-COVID&#39;),
    dow = fct_relevel(dow, &quot;Sunday&quot;, &quot;Saturday&quot;, &quot;Friday&quot;, &quot;Thursday&quot;, &quot;Wednesday&quot;, &quot;Tuesday&quot;)
  ) </code></pre>
<pre><code>## `summarise()` regrouping output by &#39;covid&#39;, &#39;hour&#39; (override with `.groups` argument)</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `dow`.
## i Unknown levels in `f`: Wednesday, Tuesday
## i Input `dow` is `fct_relevel(...)`.
## i The error occurred in group 2: covid = &quot;COVID&quot;, hour = &quot;01&quot;.</code></pre>
<pre><code>## Warning: Unknown levels in `f`: Wednesday, Tuesday</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `dow`.
## i Unknown levels in `f`: Saturday, Thursday, Wednesday, Tuesday
## i Input `dow` is `fct_relevel(...)`.
## i The error occurred in group 5: covid = &quot;COVID&quot;, hour = &quot;04&quot;.</code></pre>
<pre><code>## Warning: Unknown levels in `f`: Saturday, Thursday, Wednesday, Tuesday</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `dow`.
## i Unknown levels in `f`: Wednesday
## i Input `dow` is `fct_relevel(...)`.
## i The error occurred in group 6: covid = &quot;COVID&quot;, hour = &quot;05&quot;.</code></pre>
<pre><code>## Warning: Unknown levels in `f`: Wednesday</code></pre>
<pre class="r"><code>pre_bike_err = 
  day_time_bike_err %&gt;%
  filter(covid == &quot;Pre-COVID&quot;) %&gt;%
  plot_ly(
    x = ~hour, y = ~dow, z = ~collisions, type = &quot;heatmap&quot;, colors = &quot;Blues&quot;
  ) %&gt;%
  hide_colorbar() %&gt;%
  layout(annotations = a)

covid_bike_err = 
  day_time_bike_err %&gt;%
  filter(covid == &quot;COVID&quot;) %&gt;%
  plot_ly(
    x = ~hour, y = ~dow, z = ~collisions, type = &quot;heatmap&quot;, colors = &quot;Blues&quot;
  ) %&gt;%
  hide_colorbar() %&gt;%
  layout(annotations = b)

subplot(pre_bike_err, covid_bike_err, nrows = 2, margin = .1)</code></pre>
<div id="htmlwidget-602d5a4ca5d1fc9fa5fe" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-602d5a4ca5d1fc9fa5fe">{"x":{"data":[{"colorbar":{"title":"collisions","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(247,251,255,1)"],["0.0416666666666667","rgba(239,246,252,1)"],["0.0833333333333333","rgba(230,240,250,1)"],["0.125","rgba(222,235,247,1)"],["0.166666666666667","rgba(214,230,244,1)"],["0.208333333333333","rgba(206,224,242,1)"],["0.25","rgba(198,219,239,1)"],["0.291666666666667","rgba(185,213,234,1)"],["0.333333333333333","rgba(172,208,230,1)"],["0.375","rgba(158,202,225,1)"],["0.416666666666667","rgba(142,193,221,1)"],["0.458333333333333","rgba(125,183,218,1)"],["0.5","rgba(107,174,214,1)"],["0.541666666666667","rgba(94,165,209,1)"],["0.583333333333333","rgba(81,155,203,1)"],["0.625","rgba(66,146,198,1)"],["0.666666666666667","rgba(57,135,192,1)"],["0.708333333333333","rgba(46,124,187,1)"],["0.75","rgba(33,113,181,1)"],["0.791666666666667","rgba(27,102,173,1)"],["0.833333333333333","rgba(19,91,164,1)"],["0.875","rgba(8,81,156,1)"],["0.916666666666667","rgba(9,70,139,1)"],["0.958333333333333","rgba(9,59,123,1)"],["1","rgba(8,48,107,1)"]],"showscale":false,"x":["00","00","00","00","00","00","00","01","01","01","01","01","01","01","02","02","02","02","02","02","02","03","03","03","03","03","03","04","04","04","04","04","04","04","05","05","05","05","05","05","05","06","06","06","06","06","06","06","07","07","07","07","07","07","07","08","08","08","08","08","08","08","09","09","09","09","09","09","09","10","10","10","10","10","10","10","11","11","11","11","11","11","11","12","12","12","12","12","12","12","13","13","13","13","13","13","13","14","14","14","14","14","14","14","15","15","15","15","15","15","15","16","16","16","16","16","16","16","17","17","17","17","17","17","17","18","18","18","18","18","18","18","19","19","19","19","19","19","19","20","20","20","20","20","20","20","21","21","21","21","21","21","21","22","22","22","22","22","22","22","23","23","23","23","23","23","23"],"y":["Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday"],"z":[26,21,29,25,34,17,18,13,4,14,8,6,3,3,5,3,9,8,7,3,8,3,9,5,3,2,3,2,4,7,7,3,1,6,2,6,7,7,6,3,1,13,6,1,3,11,8,14,21,12,4,6,18,17,23,22,35,10,7,25,33,38,38,32,16,14,31,31,24,22,22,26,21,31,32,27,32,34,30,26,23,24,31,35,33,39,32,29,31,39,42,39,43,54,28,34,41,47,37,54,58,39,32,42,40,34,43,44,46,41,43,56,58,47,52,49,59,45,61,58,36,53,59,72,52,47,53,41,46,46,53,59,47,44,34,54,45,49,48,51,37,38,43,39,40,41,33,33,49,38,27,40,33,32,41,40,26,32,28,25,25,20,25,11,25,16,19],"type":"heatmap","xaxis":"x","yaxis":"y","frame":null},{"colorbar":{"title":"collisions","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(247,251,255,1)"],["0.0416666666666667","rgba(239,246,252,1)"],["0.0833333333333333","rgba(230,240,250,1)"],["0.125","rgba(222,235,247,1)"],["0.166666666666667","rgba(214,230,244,1)"],["0.208333333333333","rgba(206,224,242,1)"],["0.25","rgba(198,219,239,1)"],["0.291666666666667","rgba(185,213,234,1)"],["0.333333333333333","rgba(172,208,230,1)"],["0.375","rgba(158,202,225,1)"],["0.416666666666667","rgba(142,193,221,1)"],["0.458333333333333","rgba(125,183,218,1)"],["0.5","rgba(107,174,214,1)"],["0.541666666666667","rgba(94,165,209,1)"],["0.583333333333333","rgba(81,155,203,1)"],["0.625","rgba(66,146,198,1)"],["0.666666666666667","rgba(57,135,192,1)"],["0.708333333333333","rgba(46,124,187,1)"],["0.75","rgba(33,113,181,1)"],["0.791666666666667","rgba(27,102,173,1)"],["0.833333333333333","rgba(19,91,164,1)"],["0.875","rgba(8,81,156,1)"],["0.916666666666667","rgba(9,70,139,1)"],["0.958333333333333","rgba(9,59,123,1)"],["1","rgba(8,48,107,1)"]],"showscale":false,"x":["00","00","00","00","00","00","00","01","01","01","01","01","02","02","02","02","02","02","03","03","03","03","03","03","03","04","04","05","05","05","05","05","05","06","06","06","06","06","06","06","07","07","07","07","07","07","07","08","08","08","08","08","08","08","09","09","09","09","09","09","09","10","10","10","10","10","10","10","11","11","11","11","11","11","11","12","12","12","12","12","12","12","13","13","13","13","13","13","13","14","14","14","14","14","14","14","15","15","15","15","15","15","15","16","16","16","16","16","16","16","17","17","17","17","17","17","17","18","18","18","18","18","18","18","19","19","19","19","19","19","19","20","20","20","20","20","20","20","21","21","21","21","21","21","21","22","22","22","22","22","22","22","23","23","23","23","23","23","23"],"y":["Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Friday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Sunday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday"],"z":[7,6,4,3,6,3,8,3,2,1,7,2,4,2,3,2,3,2,2,1,2,6,1,2,1,1,4,2,2,2,2,1,2,3,2,1,1,3,4,1,5,4,3,2,7,1,3,5,4,5,2,9,9,9,6,5,3,3,2,6,6,8,4,5,5,9,5,4,10,4,11,6,7,4,6,8,12,6,8,14,6,6,13,7,10,14,13,6,12,11,6,15,16,6,7,8,16,8,14,5,9,10,13,17,17,21,18,15,14,18,18,14,15,10,22,18,30,20,19,16,11,14,14,13,13,9,13,11,17,17,15,8,9,14,12,15,15,9,10,13,12,8,12,12,7,7,2,12,8,8,4,14,7,8,9,7,5,2,3],"type":"heatmap","xaxis":"x2","yaxis":"y2","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"type":"category","categoryorder":"array","categoryarray":["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],"anchor":"y"},"xaxis2":{"domain":[0,1],"automargin":true,"type":"category","categoryorder":"array","categoryarray":["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],"anchor":"y2"},"yaxis2":{"domain":[0,0.4],"automargin":true,"type":"category","categoryorder":"array","categoryarray":["Sunday","Saturday","Friday","Thursday","Wednesday","Tuesday","Monday"],"anchor":"x2"},"yaxis":{"domain":[0.6,1],"automargin":true,"type":"category","categoryorder":"array","categoryarray":["Sunday","Saturday","Friday","Thursday","Wednesday","Tuesday","Monday"],"anchor":"x"},"annotations":[{"text":"Pre-COVID","xref":"paper","yref":"paper","yanchor":"bottom","xanchor":"center","align":"center","x":0.5,"y":1,"showarrow":false},{"text":"COVID","xref":"paper","yref":"paper","yanchor":"bottom","xanchor":"center","align":"center","x":0.5,"y":0.4,"showarrow":false}],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"zaxis":{"title":"collisions"}},"hovermode":"closest","showlegend":true,"legend":{"yanchor":"top","y":0.5}},"attrs":{"828839ec44f":{"x":{},"y":{},"z":{},"colors":"Blues","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"heatmap"},"82885aae6a27":{"x":{},"y":{},"z":{},"colors":"Blues","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"heatmap"}},"source":"A","config":{"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Similar to heat maps above, crashes where the cyclist made an error are clustered in the evening hours and there is slightly more clustering during COVID than pre-COVID.</p>
<p>Similar to the above analysis, we next explored clustering by time of day and day of week based on whether the crash had a contributing factor of driver inattention, which showed an increase in prevalence during COVID.</p>
<pre class="r"><code>day_time_drive_err = 
  bikes %&gt;%
  pivot_longer(
    contributing_factor_vehicle_1:contributing_factor_vehicle_5,
    names_to = &quot;vehicle_factor_num&quot;,
    names_prefix = &quot;contributing_factor_vehicle_&quot;,
    values_to = &quot;contributing_factor&quot;
   ) %&gt;%
  filter(
    contributing_factor == &quot;Driver Inattention/Distraction&quot;
    ) %&gt;%
  group_by(covid, hour, dow) %&gt;%
  summarise(
    collisions = n_distinct(collision_id)
  ) %&gt;%
  mutate(
    covid = fct_relevel(covid, &#39;Pre-COVID&#39;),
    dow = fct_relevel(dow, &quot;Sunday&quot;, &quot;Saturday&quot;, &quot;Friday&quot;, &quot;Thursday&quot;, &quot;Wednesday&quot;, &quot;Tuesday&quot;)
  ) </code></pre>
<pre><code>## `summarise()` regrouping output by &#39;covid&#39;, &#39;hour&#39; (override with `.groups` argument)</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `dow`.
## i Unknown levels in `f`: Saturday, Wednesday, Tuesday
## i Input `dow` is `fct_relevel(...)`.
## i The error occurred in group 2: covid = &quot;COVID&quot;, hour = &quot;01&quot;.</code></pre>
<pre><code>## Warning: Unknown levels in `f`: Saturday, Wednesday, Tuesday</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `dow`.
## i Unknown levels in `f`: Thursday
## i Input `dow` is `fct_relevel(...)`.
## i The error occurred in group 3: covid = &quot;COVID&quot;, hour = &quot;02&quot;.</code></pre>
<pre><code>## Warning: Unknown levels in `f`: Thursday</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `dow`.
## i Unknown levels in `f`: Friday
## i Input `dow` is `fct_relevel(...)`.
## i The error occurred in group 4: covid = &quot;COVID&quot;, hour = &quot;03&quot;.</code></pre>
<pre><code>## Warning: Unknown levels in `f`: Friday</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `dow`.
## i Unknown levels in `f`: Saturday, Friday, Wednesday, Tuesday
## i Input `dow` is `fct_relevel(...)`.
## i The error occurred in group 5: covid = &quot;COVID&quot;, hour = &quot;04&quot;.</code></pre>
<pre><code>## Warning: Unknown levels in `f`: Saturday, Friday, Wednesday, Tuesday</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `dow`.
## i Unknown levels in `f`: Sunday, Saturday, Thursday, Wednesday, Tuesday
## i Input `dow` is `fct_relevel(...)`.
## i The error occurred in group 6: covid = &quot;COVID&quot;, hour = &quot;05&quot;.</code></pre>
<pre><code>## Warning: Unknown levels in `f`: Sunday, Saturday, Thursday, Wednesday, Tuesday</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `dow`.
## i Unknown levels in `f`: Wednesday
## i Input `dow` is `fct_relevel(...)`.
## i The error occurred in group 28: covid = &quot;Pre-COVID&quot;, hour = &quot;03&quot;.</code></pre>
<pre><code>## Warning: Unknown levels in `f`: Wednesday</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `dow`.
## i Unknown levels in `f`: Wednesday
## i Input `dow` is `fct_relevel(...)`.
## i The error occurred in group 30: covid = &quot;Pre-COVID&quot;, hour = &quot;05&quot;.</code></pre>
<pre><code>## Warning: Unknown levels in `f`: Wednesday</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `dow`.
## i Unknown levels in `f`: Saturday
## i Input `dow` is `fct_relevel(...)`.
## i The error occurred in group 31: covid = &quot;Pre-COVID&quot;, hour = &quot;06&quot;.</code></pre>
<pre><code>## Warning: Unknown levels in `f`: Saturday</code></pre>
<pre class="r"><code>pre_drive_err = 
  day_time_drive_err %&gt;%
  filter(covid == &quot;Pre-COVID&quot;) %&gt;%
  plot_ly(
    x = ~hour, y = ~dow, z = ~collisions, type = &quot;heatmap&quot;, colors = &quot;YlGn&quot;
  ) %&gt;%
  hide_colorbar() %&gt;%
  layout(annotations = a)

covid_drive_err = 
  day_time_drive_err %&gt;%
  filter(covid == &quot;COVID&quot;) %&gt;%
  plot_ly(
    x = ~hour, y = ~dow, z = ~collisions, type = &quot;heatmap&quot;, colors = &quot;YlGn&quot;
  ) %&gt;%
  hide_colorbar() %&gt;% 
  layout(annotations = b)

subplot(pre_drive_err, covid_drive_err, nrows = 2, margin = .1)</code></pre>
<div id="htmlwidget-8bd0ce5389602e24fbc6" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-8bd0ce5389602e24fbc6">{"x":{"data":[{"colorbar":{"title":"collisions","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(255,255,229,1)"],["0.0416666666666667","rgba(253,254,214,1)"],["0.0833333333333333","rgba(250,253,200,1)"],["0.125","rgba(247,252,185,1)"],["0.166666666666667","rgba(237,248,178,1)"],["0.208333333333333","rgba(227,244,170,1)"],["0.25","rgba(217,240,163,1)"],["0.291666666666667","rgba(202,234,156,1)"],["0.333333333333333","rgba(188,227,149,1)"],["0.375","rgba(173,221,142,1)"],["0.416666666666667","rgba(156,213,135,1)"],["0.458333333333333","rgba(138,206,128,1)"],["0.5","rgba(120,198,121,1)"],["0.541666666666667","rgba(103,189,112,1)"],["0.583333333333333","rgba(85,180,102,1)"],["0.625","rgba(65,171,93,1)"],["0.666666666666667","rgba(55,158,84,1)"],["0.708333333333333","rgba(45,145,76,1)"],["0.75","rgba(35,132,67,1)"],["0.791666666666667","rgba(26,123,63,1)"],["0.833333333333333","rgba(14,113,59,1)"],["0.875","rgba(0,104,55,1)"],["0.916666666666667","rgba(0,92,50,1)"],["0.958333333333333","rgba(0,80,46,1)"],["1","rgba(0,69,41,1)"]],"showscale":false,"x":["00","00","00","00","00","00","00","01","01","01","01","01","01","01","02","02","02","02","02","02","02","03","03","03","03","03","04","04","04","04","04","04","04","05","05","05","05","05","05","06","06","06","06","06","06","07","07","07","07","07","07","07","08","08","08","08","08","08","08","09","09","09","09","09","09","09","10","10","10","10","10","10","10","11","11","11","11","11","11","11","12","12","12","12","12","12","12","13","13","13","13","13","13","13","14","14","14","14","14","14","14","15","15","15","15","15","15","15","16","16","16","16","16","16","16","17","17","17","17","17","17","17","18","18","18","18","18","18","18","19","19","19","19","19","19","19","20","20","20","20","20","20","20","21","21","21","21","21","21","21","22","22","22","22","22","22","22","23","23","23","23","23","23","23"],"y":["Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Saturday","Sunday","Thursday","Tuesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Friday","Monday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday"],"z":[18,14,21,17,23,13,13,8,1,6,5,4,4,1,5,1,6,4,6,1,6,3,4,2,2,1,1,3,5,4,2,1,6,3,4,3,3,4,3,6,5,2,9,5,7,12,3,7,4,15,14,17,19,22,10,6,23,27,25,22,18,16,6,19,31,22,14,17,21,17,18,20,13,23,18,22,13,31,20,24,23,27,27,22,24,22,25,33,21,31,31,20,22,28,44,29,43,39,39,25,31,37,27,29,22,35,31,37,40,42,26,49,31,50,40,46,41,33,28,46,53,47,37,38,39,35,39,37,43,25,25,30,38,33,38,36,35,28,28,38,34,33,32,27,23,29,30,30,36,35,29,26,24,23,33,23,17,17,6,21,9,19,8,18],"type":"heatmap","xaxis":"x","yaxis":"y","frame":null},{"colorbar":{"title":"collisions","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(255,255,229,1)"],["0.0416666666666667","rgba(253,254,214,1)"],["0.0833333333333333","rgba(250,253,200,1)"],["0.125","rgba(247,252,185,1)"],["0.166666666666667","rgba(237,248,178,1)"],["0.208333333333333","rgba(227,244,170,1)"],["0.25","rgba(217,240,163,1)"],["0.291666666666667","rgba(202,234,156,1)"],["0.333333333333333","rgba(188,227,149,1)"],["0.375","rgba(173,221,142,1)"],["0.416666666666667","rgba(156,213,135,1)"],["0.458333333333333","rgba(138,206,128,1)"],["0.5","rgba(120,198,121,1)"],["0.541666666666667","rgba(103,189,112,1)"],["0.583333333333333","rgba(85,180,102,1)"],["0.625","rgba(65,171,93,1)"],["0.666666666666667","rgba(55,158,84,1)"],["0.708333333333333","rgba(45,145,76,1)"],["0.75","rgba(35,132,67,1)"],["0.791666666666667","rgba(26,123,63,1)"],["0.833333333333333","rgba(14,113,59,1)"],["0.875","rgba(0,104,55,1)"],["0.916666666666667","rgba(0,92,50,1)"],["0.958333333333333","rgba(0,80,46,1)"],["1","rgba(0,69,41,1)"]],"showscale":false,"x":["00","00","00","00","00","00","00","01","01","01","02","02","02","02","02","03","03","03","03","03","03","04","04","05","05","06","06","06","06","06","06","06","07","07","07","07","07","07","07","08","08","08","08","08","08","08","09","09","09","09","09","09","09","10","10","10","10","10","10","10","11","11","11","11","11","11","11","12","12","12","12","12","12","12","13","13","13","13","13","13","13","14","14","14","14","14","14","14","15","15","15","15","15","15","15","16","16","16","16","16","16","16","17","17","17","17","17","17","17","18","18","18","18","18","18","18","19","19","19","19","19","19","19","20","20","20","20","20","20","20","21","21","21","21","21","21","21","22","22","22","22","22","22","22","23","23","23","23","23","23","23"],"y":["Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Sunday","Thursday","Friday","Saturday","Sunday","Tuesday","Wednesday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Sunday","Thursday","Friday","Monday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday","Friday","Monday","Saturday","Sunday","Thursday","Tuesday","Wednesday"],"z":[4,6,6,8,5,5,2,1,3,3,3,1,5,1,1,1,1,6,1,1,1,2,1,3,3,4,3,2,2,3,5,3,4,3,1,2,4,3,4,6,4,2,4,8,8,9,4,4,2,5,4,6,8,5,3,7,2,3,5,2,4,5,10,7,6,8,2,4,13,5,9,14,9,8,11,5,10,13,13,6,7,11,5,11,8,5,8,6,15,11,8,7,7,7,8,17,16,23,13,19,14,18,18,20,10,10,19,12,19,16,18,12,12,20,15,13,10,11,12,9,12,22,14,10,10,9,15,7,21,7,6,9,11,9,9,9,5,6,2,7,9,6,4,8,7,6,8,6,6,1,6],"type":"heatmap","xaxis":"x2","yaxis":"y2","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"type":"category","categoryorder":"array","categoryarray":["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],"anchor":"y"},"xaxis2":{"domain":[0,1],"automargin":true,"type":"category","categoryorder":"array","categoryarray":["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],"anchor":"y2"},"yaxis2":{"domain":[0,0.4],"automargin":true,"type":"category","categoryorder":"array","categoryarray":["Sunday","Saturday","Friday","Thursday","Wednesday","Tuesday","Monday"],"anchor":"x2"},"yaxis":{"domain":[0.6,1],"automargin":true,"type":"category","categoryorder":"array","categoryarray":["Sunday","Saturday","Friday","Thursday","Wednesday","Tuesday","Monday"],"anchor":"x"},"annotations":[{"text":"Pre-COVID","xref":"paper","yref":"paper","yanchor":"bottom","xanchor":"center","align":"center","x":0.5,"y":1,"showarrow":false},{"text":"COVID","xref":"paper","yref":"paper","yanchor":"bottom","xanchor":"center","align":"center","x":0.5,"y":0.4,"showarrow":false}],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"zaxis":{"title":"collisions"}},"hovermode":"closest","showlegend":true,"legend":{"yanchor":"top","y":0.5}},"attrs":{"82885bba4a8b":{"x":{},"y":{},"z":{},"colors":"YlGn","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"heatmap"},"8288b81f97":{"x":{},"y":{},"z":{},"colors":"YlGn","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"heatmap"}},"source":"A","config":{"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Similar to heat maps involving contributing factors attributed to the cyclist, crashes with a contributing factor of driver inattention were clustered in the evening hours, with slightly more clustering during COVID as compared to pre-COVID.</p>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
