<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Poisson Analysis</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="project_report.html">Our Project</a>
    </li>
    <li>
      <a href="about.html">Us</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Sections
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="geolocation_maps.html">Location of Incidents in NYC</a>
    </li>
    <li>
      <a href="plots_over_time.html">Trend of Incidents in NYC over time</a>
    </li>
    <li>
      <a href="contributing_factors.html">Contributing Factors</a>
    </li>
    <li>
      <a href="20201125_InjuryPlots.html">Poisson Analysis</a>
    </li>
    <li>
      <a href="weather_lm.html">Predictive Model</a>
    </li>
  </ul>
</li>
<li>
  <a href="mailto:&lt;tmc2184@cumc.columbia.edu&gt;">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/byilma/nyc_microvehicle_injuries">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Poisson Analysis</h1>

</div>


<pre class="r"><code>crash_dat_tidy = read_csv(&quot;./data/crash_dat.csv&quot;) </code></pre>
<div id="goal" class="section level2">
<h2>Goal</h2>
<p>My goal was to compare the rate of injuries in a crash in 2020 to the same month in 2019 (e.g., rate of injuries in January 2020 v. rate of injuries in January 2019). I examined January through October. I additionally stratified these rate ratio estimates by borough.</p>
<p>To accomplish this, I filtered the tidy data to create one dataset for microvehicles and one for bikes. In each dataset, I then created nested datasets by month, and, in each of these datasets, I mapped Poisson models to extract rate ratio estimates for number of injuries in each borough. Finally, I unnessted these models to extract the desired coefficients: rate ratios and standard errors (used to compute 95% confidence intervals).</p>
<p>Below, I write functions to easily filter for either microvehicles or for bikes.</p>
<pre class="r"><code>filter_for = function(dataset, type) {
  if (type == &quot;micro&quot;) {
  dataset %&gt;% filter(str_detect(vehicle_options, &quot;[Bb]ike&quot;) | 
           str_detect(vehicle_options, &quot;REVEL&quot;) | 
           str_detect(vehicle_options, &quot;SCO&quot;)  |
           str_detect(vehicle_options, &quot;MOP&quot;)   |
           str_detect(vehicle_options, &quot;ELEC&quot;)  |
           str_detect(vehicle_options, &quot;^E-&quot;)) %&gt;% 
  filter(vehicle_options != &quot;ESCOVATOR&quot; &amp; vehicle_options != &quot;Bike&quot; &amp;
      str_detect(vehicle_options, &quot;Dirt&quot;, negate = TRUE),
      str_detect(vehicle_options, &quot;[Mm]otorbike&quot;, negate = TRUE)
           )
}

  else if (type == &quot;bike&quot;) {
  dataset %&gt;% filter(str_starts(vehicle_options, &quot;[Bb]ike&quot;)) 
  }
}</code></pre>
<pre class="r"><code>month_df=
  tibble(
    month = 1:12,
    month_name = factor(month.name, ordered = TRUE, levels = month.name)
  )</code></pre>
<p><br></br></p>
</div>
<div id="microvehicles" class="section level2">
<h2>Microvehicles</h2>
<p>First, I tested to see if there was an overall association of 2020 v. 2019 with number of injuries in microvehicle crashes.</p>
<pre class="r"><code>fit_injuries_micro_all = crash_dat_tidy %&gt;%
  filter_for(&quot;micro&quot;) %&gt;% 
  filter(year %in% c(2019, 2020)) %&gt;%
  group_by(year) %&gt;%
  mutate(year_2020 = year - 2019) %&gt;%
  nest(data = -month) %&gt;%
  mutate(models = map(data, ~glm(number_of_persons_injured ~ year_2020,
                                 family = &quot;poisson&quot;, data = .x)),
         models = map(models, broom::tidy)) %&gt;% 
  select(-data) %&gt;% 
  unnest(models) %&gt;%
  select(month, term, estimate, std.error, p.value) %&gt;% 
  mutate(term = str_replace(term, &quot;year_2020&quot;, &quot;2020 v. 2019&quot;)) %&gt;%
  left_join(month_df, by = &quot;month&quot;) %&gt;%
  select(-month) %&gt;%
  rename(month = month_name) %&gt;%
  filter(term != &quot;(Intercept)&quot; &amp; month != &quot;November&quot; &amp; month != &quot;December&quot;) %&gt;%
  select(month, everything()) 

fit_injuries_micro_all %&gt;% knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">month</th>
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">January</td>
<td align="left">2020 v. 2019</td>
<td align="right">-0.29</td>
<td align="right">0.40</td>
<td align="right">0.47</td>
</tr>
<tr class="even">
<td align="left">February</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.74</td>
<td align="right">0.72</td>
<td align="right">0.30</td>
</tr>
<tr class="odd">
<td align="left">March</td>
<td align="left">2020 v. 2019</td>
<td align="right">-0.43</td>
<td align="right">0.32</td>
<td align="right">0.18</td>
</tr>
<tr class="even">
<td align="left">April</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.14</td>
<td align="right">0.42</td>
<td align="right">0.74</td>
</tr>
<tr class="odd">
<td align="left">May</td>
<td align="left">2020 v. 2019</td>
<td align="right">-0.23</td>
<td align="right">0.26</td>
<td align="right">0.39</td>
</tr>
<tr class="even">
<td align="left">June</td>
<td align="left">2020 v. 2019</td>
<td align="right">-0.12</td>
<td align="right">0.23</td>
<td align="right">0.61</td>
</tr>
<tr class="odd">
<td align="left">July</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.13</td>
<td align="right">0.16</td>
<td align="right">0.42</td>
</tr>
<tr class="even">
<td align="left">August</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.07</td>
<td align="right">0.11</td>
<td align="right">0.51</td>
</tr>
<tr class="odd">
<td align="left">September</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.04</td>
<td align="right">0.11</td>
<td align="right">0.69</td>
</tr>
<tr class="even">
<td align="left">October</td>
<td align="left">2020 v. 2019</td>
<td align="right">-0.06</td>
<td align="right">0.12</td>
<td align="right">0.60</td>
</tr>
</tbody>
</table>
<p>Although there was no statistically significant evidence for a different rate of injury in 2020 v. 21 in any month, I proceeded to examine this stratified by borough.</p>
<p>I also wanted to get descriptives for number of microvehicle crashes and injuries in each borough in each month.</p>
<pre class="r"><code>micro_num = crash_dat_tidy %&gt;%
  filter_for(&quot;micro&quot;) %&gt;% 
  filter(year %in% c(2019, 2020)) %&gt;%
  group_by(year, month, borough) %&gt;%
  summarise(number_of_crashes = n(),
            mean_number_of_injuries = mean(number_of_persons_injured)) %&gt;%
  drop_na(borough) %&gt;%
  left_join(month_df, by = &quot;month&quot;) %&gt;%
  as.tibble() %&gt;%
  mutate(borough = str_to_title(borough))

micro_num %&gt;%
  select(year, month_name, borough, number_of_crashes, 
         mean_number_of_injuries) %&gt;%
  head() %&gt;% knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year</th>
<th align="left">month_name</th>
<th align="left">borough</th>
<th align="right">number_of_crashes</th>
<th align="right">mean_number_of_injuries</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2019</td>
<td align="left">January</td>
<td align="left">Brooklyn</td>
<td align="right">2</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">January</td>
<td align="left">Manhattan</td>
<td align="right">1</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">January</td>
<td align="left">Queens</td>
<td align="right">1</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">February</td>
<td align="left">Bronx</td>
<td align="right">2</td>
<td align="right">0.50</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">February</td>
<td align="left">Brooklyn</td>
<td align="right">2</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">March</td>
<td align="left">Bronx</td>
<td align="right">3</td>
<td align="right">1.33</td>
</tr>
</tbody>
</table>
<pre class="r"><code>micro_num %&gt;%
  mutate(date = as.yearmon(paste(year, month, sep = &quot;-&quot;))) %&gt;%
  ggplot(aes(x = date, y = mean_number_of_injuries, fill = borough)) +
  geom_bar(stat = &quot;identity&quot;, show.legend = FALSE) +
  labs(
    title = &quot;Mean Number of Injuries per Microvehicle Crash by Borough&quot;,
    x = &quot;Month&quot;,
    y = &quot;Mean Number of Injuries&quot;
  ) +
  theme(legend.position=&quot;right&quot;, legend.title = element_blank(),
        text = element_text(size = 10),
        axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) +
  facet_grid(. ~ borough)</code></pre>
<p><img src="20201125_InjuryPlots_files/figure-html/graph%20for%20mean%20injuries%20in%20microvehicle%20crashes-1.png" width="768" /></p>
<pre class="r"><code>micro_num %&gt;%
  mutate(date = as.yearmon(paste(year, month, sep = &quot;-&quot;))) %&gt;%
  ggplot(aes(x = date, y = number_of_crashes, fill = borough)) +
  geom_bar(stat = &quot;identity&quot;, show.legend = FALSE) +
  labs(
    title = &quot;Number of Crashes by Borough&quot;,
    x = &quot;Month&quot;,
    y = &quot;Number of Crashes&quot;
  ) +
  theme(legend.position=&quot;right&quot;, legend.title = element_blank(),
        text = element_text(size = 10),
        axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) +
  facet_grid(. ~ borough)</code></pre>
<p><img src="20201125_InjuryPlots_files/figure-html/graph%20for%20n%20microvehicle%20crashes-1.png" width="672" /></p>
<p>It is apparent that there are very low numbers of microvehicle crashes when stratifying by both month and borough - sometimes as low as only 1 crash, or even 0 crashes (particularly in Staten Island).</p>
<p>Below, I extract the rate ratio estimates for the microvehicle data by borough.</p>
<pre class="r"><code>fit_injuries_micro = crash_dat_tidy %&gt;%
  filter_for(&quot;micro&quot;) %&gt;% 
  filter(year %in% c(2019, 2020)) %&gt;%
  mutate(borough = str_to_title(borough)) %&gt;%
  group_by(year) %&gt;%
  mutate(year_2020 = year - 2019) %&gt;%
  nest(data = -month) %&gt;%
  mutate(models = map(data, ~glm(number_of_persons_injured ~ year_2020:borough,
                                 family = &quot;poisson&quot;, data = .x)),
         models = map(models, broom::tidy)) %&gt;% 
  select(-data) %&gt;% 
  unnest(models) %&gt;%
  select(month, term, estimate, std.error, p.value) %&gt;% 
  mutate(term = str_replace(term, &quot;year_2020:borough&quot;, &quot;2020 v. 2019, Borough: &quot;)) %&gt;%
  left_join(month_df, by = &quot;month&quot;) %&gt;%
  select(-month) %&gt;%
  rename(month = month_name) %&gt;%
  select(month, everything())

fit_injuries_micro %&gt;% 
  filter(term != &quot;(Intercept)&quot; &amp; month != &quot;November&quot; &amp; month != &quot;December&quot; &amp; p.value &lt; .05) %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">month</th>
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>Here, I extract my coefficient of interest, which is the difference in injury rate in microvehicle crashes occurring in 2020 v. occurring in 2019. I plot estimates for each borough within each month, making sure to exponentiate these estimates. I include a horizontal line at Y = 1 to indicate the null value.</p>
<pre class="r"><code>fit_injuries_micro %&gt;% 
  filter(term != &quot;(Intercept)&quot; &amp; month != &quot;November&quot; &amp; month != &quot;December&quot;) %&gt;%
  mutate(term = str_replace(term, &quot;2020 v. 2019, &quot;, &quot;&quot;)) %&gt;%
  ggplot(aes(x = month, y = exp(estimate), color = term)) + 
  geom_point(show.legend = FALSE, aes(size = estimate, alpha = .7)) +
  geom_errorbar(aes(ymin = exp(estimate - (1.96*std.error)), 
                    ymax = exp(estimate + (1.96*std.error)))) +
  geom_hline(yintercept = 1, linetype=&quot;dashed&quot;, 
                color = &quot;darkred&quot;, size = 1, alpha = .7) +
  labs(
    title = &quot;Difference in Rate of Injuries Per Crash Involving a Microvehicle in 2020 v. 2019&quot;,
    x = &quot;Month&quot;,
    y = &quot;2020 v. 2019 Difference&quot;
  ) +
  ylim(0, 5) +
  theme(legend.position=&quot;right&quot;, legend.title = element_blank(),
        text = element_text(size = 10),
        axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) + 
  facet_grid(. ~ term)</code></pre>
<p><img src="20201125_InjuryPlots_files/figure-html/plot%20microvehicle%20injuries%20by%20month-1.png" width="768" /></p>
<p>There is no discernable pattern in the figure, suggesting that rates of injury per microvehicle crash did not differ between 2020 and 2019. In part, this could be due to very wide confidence intervals.</p>
<p><br></br></p>
</div>
<div id="bikes" class="section level2">
<h2>Bikes</h2>
<p>Again, I first tested to see if there was an overall association of 2020 v. 2019 with number of injuries in bike crashes (as in the microvehicle data).</p>
<pre class="r"><code>fit_injuries_bike_all = crash_dat_tidy %&gt;%
  filter_for(&quot;bike&quot;) %&gt;% 
  filter(year %in% c(2019, 2020)) %&gt;%
  group_by(year) %&gt;%
  mutate(year_2020 = year - 2019) %&gt;%
  nest(data = -month) %&gt;%
  mutate(models = map(data, ~glm(number_of_persons_injured ~ year_2020,
                                 family = &quot;poisson&quot;, data = .x)),
         models = map(models, broom::tidy)) %&gt;% 
  select(-data) %&gt;% 
  unnest(models) %&gt;%
  select(month, term, estimate, std.error, p.value) %&gt;% 
  mutate(term = str_replace(term, &quot;year_2020&quot;, &quot;2020 v. 2019&quot;)) %&gt;%
  left_join(month_df, by = &quot;month&quot;) %&gt;%
  select(-month) %&gt;%
  rename(month = month_name) %&gt;%
  filter(term != &quot;(Intercept)&quot; &amp; month != &quot;November&quot; &amp; month != &quot;December&quot;) %&gt;%
  select(month, everything()) 

fit_injuries_bike_all %&gt;% knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">month</th>
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">January</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.01</td>
<td align="right">0.09</td>
<td align="right">0.89</td>
</tr>
<tr class="even">
<td align="left">February</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.03</td>
<td align="right">0.10</td>
<td align="right">0.78</td>
</tr>
<tr class="odd">
<td align="left">March</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.13</td>
<td align="right">0.09</td>
<td align="right">0.13</td>
</tr>
<tr class="even">
<td align="left">April</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.01</td>
<td align="right">0.10</td>
<td align="right">0.96</td>
</tr>
<tr class="odd">
<td align="left">May</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.01</td>
<td align="right">0.07</td>
<td align="right">0.90</td>
</tr>
<tr class="even">
<td align="left">June</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.02</td>
<td align="right">0.06</td>
<td align="right">0.69</td>
</tr>
<tr class="odd">
<td align="left">July</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.35</td>
</tr>
<tr class="even">
<td align="left">August</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.04</td>
<td align="right">0.06</td>
<td align="right">0.51</td>
</tr>
<tr class="odd">
<td align="left">September</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.04</td>
<td align="right">0.06</td>
<td align="right">0.47</td>
</tr>
<tr class="even">
<td align="left">October</td>
<td align="left">2020 v. 2019</td>
<td align="right">0.08</td>
<td align="right">0.07</td>
<td align="right">0.24</td>
</tr>
</tbody>
</table>
<p>Although there was no statistically significant evidence for a different rate of injury in 2020 v. 21 in any month, I proceeded to examine this stratified by borough.</p>
<p>I also wanted to get descriptives for number of bike crashes and injuries in each borough in each month.</p>
<pre class="r"><code>bike_num = crash_dat_tidy %&gt;%
  filter_for(&quot;bike&quot;) %&gt;% 
  filter(year %in% c(2019, 2020)) %&gt;%
  group_by(year, month, borough) %&gt;%
  summarise(number_of_crashes = n(),
            mean_number_of_injuries = mean(number_of_persons_injured)) %&gt;%
  drop_na(borough) %&gt;%
  left_join(month_df, by = &quot;month&quot;) %&gt;%
  as.tibble() %&gt;%
  mutate(borough = str_to_title(borough))

bike_num %&gt;%
  select(year, month_name, borough, number_of_crashes, 
         mean_number_of_injuries) %&gt;%
  head() %&gt;% knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year</th>
<th align="left">month_name</th>
<th align="left">borough</th>
<th align="right">number_of_crashes</th>
<th align="right">mean_number_of_injuries</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2019</td>
<td align="left">January</td>
<td align="left">Bronx</td>
<td align="right">17</td>
<td align="right">0.76</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">January</td>
<td align="left">Brooklyn</td>
<td align="right">74</td>
<td align="right">0.85</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">January</td>
<td align="left">Manhattan</td>
<td align="right">67</td>
<td align="right">0.76</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">January</td>
<td align="left">Queens</td>
<td align="right">41</td>
<td align="right">0.88</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">January</td>
<td align="left">Staten Island</td>
<td align="right">1</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">February</td>
<td align="left">Bronx</td>
<td align="right">18</td>
<td align="right">0.83</td>
</tr>
</tbody>
</table>
<pre class="r"><code>bike_num %&gt;%
  mutate(date = as.yearmon(paste(year, month, sep = &quot;-&quot;))) %&gt;%
  ggplot(aes(x = date, y = mean_number_of_injuries, fill = borough)) +
  geom_bar(stat = &quot;identity&quot;, show.legend = FALSE) +
  labs(
    title = &quot;Mean Number of Injuries per Bike Crash by Borough&quot;,
    x = &quot;Month&quot;,
    y = &quot;Mean Number of Injuries&quot;
  ) +
  theme(legend.position=&quot;right&quot;, legend.title = element_blank(),
        text = element_text(size = 10),
        axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) +
  facet_grid(. ~ borough)</code></pre>
<p><img src="20201125_InjuryPlots_files/figure-html/graph%20for%20mean%20injuries%20in%20bike%20crashes-1.png" width="768" /></p>
<pre class="r"><code>bike_num %&gt;%
  mutate(date = as.yearmon(paste(year, month, sep = &quot;-&quot;))) %&gt;%
  ggplot(aes(x = date, y = number_of_crashes, fill = borough)) +
  geom_bar(stat = &quot;identity&quot;, show.legend = FALSE) +
  labs(
    title = &quot;Number of Bike Crashes by Borough&quot;,
    x = &quot;Month&quot;,
    y = &quot;Number of Crashes&quot;
  ) +
  theme(legend.position=&quot;right&quot;, legend.title = element_blank(),
        text = element_text(size = 10),
        axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) +
  facet_grid(. ~ borough)</code></pre>
<p><img src="20201125_InjuryPlots_files/figure-html/graph%20for%20for%20n%20bike%20crashes-1.png" width="768" /></p>
<p>It is again apparent that there are very low numbers of crashes when stratifying by both month and borough.</p>
<p>Below, I extract the rate ratio estimates for the bike data by borough (as in the microvehicle data).</p>
<pre class="r"><code>fit_injuries_bike = crash_dat_tidy %&gt;%
  filter_for(&quot;bike&quot;) %&gt;% 
  mutate(borough = str_to_title(borough)) %&gt;%
  filter(year %in% c(2019, 2020)) %&gt;%
  group_by(year) %&gt;%
  mutate(year_2020 = year - 2019) %&gt;%
  nest(data = -month) %&gt;%
  mutate(models = map(data, ~glm(number_of_persons_injured ~ year_2020:borough,
                                 family = &quot;poisson&quot;, data = .x)),
         models = map(models, broom::tidy)) %&gt;% 
  select(-data) %&gt;% 
  unnest(models) %&gt;%
  select(month, term, estimate, std.error, p.value) %&gt;% 
  mutate(term = str_replace(term, &quot;year_2020:borough&quot;, &quot;2020 v. 2019, Borough: &quot;)) %&gt;%
  left_join(month_df, by = &quot;month&quot;) %&gt;%
  select(-month) %&gt;%
  rename(month = month_name) %&gt;%
  select(month, everything())

fit_injuries_bike %&gt;% 
  filter(term != &quot;(Intercept)&quot; &amp; month != &quot;November&quot; &amp; month != &quot;December&quot; &amp; p.value &lt; .05) %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">month</th>
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">March</td>
<td align="left">2020 v. 2019, Borough: Brooklyn</td>
<td align="right">0.27</td>
<td align="right">0.13</td>
<td align="right">0.03</td>
</tr>
</tbody>
</table>
<p>Below, I plot the estimates for the bike data (as in the microvehicle data).</p>
<pre class="r"><code>fit_injuries_bike %&gt;% 
  filter(term != &quot;(Intercept)&quot; &amp; month != &quot;November&quot; &amp; month != &quot;December&quot;) %&gt;%
  mutate(term = str_replace(term, &quot;2020 v. 2019, &quot;, &quot;&quot;)) %&gt;%
  ggplot(aes(x = month, y = exp(estimate), color = term)) + 
  geom_point(show.legend = FALSE, aes(size = estimate, alpha = .7)) +
  geom_errorbar(aes(ymin = exp(estimate - (1.96*std.error)), 
                    ymax = exp(estimate + (1.96*std.error)))) +
  geom_hline(yintercept = 1, linetype=&quot;dashed&quot;, 
                color = &quot;darkred&quot;, size = 1, alpha = .7) +
  labs(
    title = &quot;Difference in Rate of Injuries Per Crash Involving a Bike in 2020 v. 2019&quot;,
    x = &quot;Month&quot;,
    y = &quot;2020 v. 2019 Difference&quot;
  ) +
  ylim(0, 5) +
  theme(legend.position=&quot;right&quot;, legend.title = element_blank(),
        text = element_text(size = 10),
        axis.text.x = element_text(angle = 60, hjust = 1, size = 8)) + 
  facet_grid(. ~ term)</code></pre>
<p><img src="20201125_InjuryPlots_files/figure-html/plot%20bike%20injuries%20by%20month-1.png" width="768" /></p>
<p>There is no discernable pattern in the figure, suggesting that rates of injury per bike crash did not differ between 2020 and 2019.</p>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p>In sum, there was no evidence that rates of injuries per crash differed between 2020 and 2019 for crashes that involved either microvehicles or bikes.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
